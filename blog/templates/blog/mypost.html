{% extends "base.html" %}
{% load static %}
{% block extra-css %}
<link rel="stylesheet" href="{% static 'css/blog.css' %}">
<style>
  .btn-click {
    background-color: #378d06;
    color: white;
  }

  .btn-view {
    background: var(--gradient-primary);
    color: white;
  }

  .search-btn:hover {
    background-color: #7927ab;
  }
</style>
{% endblock extra-css %}
{% block main-content %}
<!-- Page Header -->
<header class="page-header">
  <div class="container text-center">
    <h1 class="page-title">My Blog Posts</h1>
    <p class="page-subtitle">Thoughts, insights, and stories from my journey in tech and life.
      Sharing knowledge and experiences one post at a time.</p>
    <a href="{% url 'create_blog' %}" class="btn-create">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14" />
      </svg>
      Add New Post
    </a>
  </div>
</header>

<main class="container">
  <!-- Stats and Filters -->
  <div class="stats-bar d-flex justify-content-between align-items-center flex-wrap">
    <div class="d-flex align-items-center gap-3">
      <span class="fw-bold">{{ post_count }} Post{{ post_count|pluralize }}</span>
      <span class="text-muted">‚Ä¢</span>
      <span class="text-muted">Updated daily</span>
    </div>
    <!-- Search Block (placeholder) -->

    <div class="me-3">
      <form method="GET" class="d-flex mb-4" role="search">
        <input type="text" name="search" value="{{ search }}" class="form-control me-2"
          placeholder="Search your posts...">
        <button type="submit" class="btn btn-outline-primary search-btn">üîç Search</button>
      </form>

    </div>

    <div class="filter-tabs d-none d-md-flex">
      <a href="?filter=all" class="filter-tab {% if not filter_type or filter_type == 'all' %}active{% endif %}">All
        Posts</a>
      <a href="?filter=recent{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
        class="filter-tab {% if filter_type == 'recent' %}active{% endif %}">Recent</a>
      <a href="?filter=popular{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
        class="filter-tab {% if filter_type == 'popular' %}active{% endif %}">Popular</a>
    </div>

  </div>
  {% if messages %}
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }} mb-3">
    {{ message }}
  </div>
  {% endfor %}
  {% endif %}
  <!-- Blog Posts Grid -->
  <div class="row g-4 blog-grid mb-5">
    {% if search %}
    <span class="text-muted">for "<strong>{{ search }}</strong>"</span>
    <a href="{% url 'blog_list' %}" class="btn btn-outline-secondary mt-3">Clear Search</a>
    {% endif %}
    {% if page_obj.object_list %}
    {% for blog in page_obj %}
    <!-- Sample Blog Post 1 -->
    <div class="col-12 col-md-6 col-xl-4">
      <article class="blog-card card">
        <img src="{% if blog.image %}{{ blog.image.url }}{% else %}/static/images/default.jpg{% endif %}"
          class="card-img-top" alt="{{ blog.title|default:'Blog post image' }}">
        <div class="card-body">
          <h3 class="blog-title">
            <a href="{% url 'blog_detail' blog.slug %}">{{blog.title}}</a>
          </h3>
          <div class="blog-meta">
            <div class="author">
              <!-- <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg> -->
              {% if blog.author.profile_image %}
              <img src="{{ blog.author.profile_image.url }}" alt="{{ blog.author.username }}'s Profile"
                class="rounded-circle me-2" width="32" height="32">
              {% else %}
              <img src="{% static 'images/img1.jpg' %}" alt="Default Avatar" class="rounded-circle me-2" width="32"
                height="32">
              {% endif %}
              {{blog.author}}
            </div>
            <div class="date">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
              </svg>
              {{blog.created_at}}
            </div>
          </div>
          <p class="blog-excerpt">
            {{blog.content|slice:":150"}}...
          </p>
          <a href="{% url 'edit_blog' blog.slug %}" class="btn btn-sm btn-outline-secondary btn-click mt-1">
            ‚úèÔ∏è Edit
          </a>
          <a href="{% url 'blog_detail' blog.slug %}" class="btn btn-sm btn-outline-secondary btn-view mt-1">
            üëÅÔ∏è View
          </a>
          <!-- Trigger Button -->
          <button type="button" class="btn btn-sm btn-danger mt-1" data-bs-toggle="modal" data-bs-target="#deleteModal{{ blog.id }}">
            üóëÔ∏è Delete
          </button>
        </div>
      </article>
    </div>
    <!-- Delete Confirmation Modal for this blog -->
    <div class="modal fade" id="deleteModal{{ blog.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ blog.id }}"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel{{ blog.id }}">Confirm Delete</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete <strong>{{ blog.title }}</strong>?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <a href="{% url 'delete_blog' blog.slug %}" class="btn btn-danger">Yes, Delete</a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="col-12 text-center py-5">
      <p class="text-muted fs-5">No Posts available.</p>
    </div>
    {% endif %}


  </div>

  <!-- Pagination -->
  <nav aria-label="Blog pagination" class="d-flex justify-content-center mb-5">
    <ul class="pagination">

      <!-- Previous -->
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link"
          href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Previous</a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
      {% endif %}

      <!-- Page Numbers: current ¬±1 -->
      {% for num in page_obj.paginator.page_range %}
      {% if num >= page_obj.number|add:'-1' and num <= page_obj.number|add:'1' %} <li
        class="page-item {% if page_obj.number == num %}active{% endif %}">
        <a class="page-link"
          href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
          {{ num }}
        </a>
        </li>
        {% endif %}
        {% endfor %}

        <!-- Next -->
        {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link"
            href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Next</a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Next</span>
        </li>
        {% endif %}

    </ul>
  </nav>
</main>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>


<script>
  // Add smooth scrolling and interaction effects
  document.addEventListener('DOMContentLoaded', function () {
    // Add loading animation for cards
    const cards = document.querySelectorAll('.blog-card');
    cards.forEach((card, index) => {
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      setTimeout(() => {
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, index * 100);
    });

    // Enhanced hover effects
    cards.forEach(card => {
      card.addEventListener('mouseenter', function () {
        this.style.transform = 'translateY(-8px) scale(1.02)';
      });

      card.addEventListener('mouseleave', function () {
        this.style.transform = 'translateY(0) scale(1)';
      });
    });
  });

</script>
<script>
  setTimeout(function () {
    const alertElements = document.querySelectorAll('.alert');
    alertElements.forEach(function (alertElement) {
      const alertInstance = bootstrap.Alert.getOrCreateInstance(alertElement);
      alertInstance.close();
    });
  }, 3000);
  const myModal = document.getElementById('myModal')
  const myInput = document.getElementById('myInput')
</script>
{% endblock main-content %}